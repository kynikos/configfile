<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>configfile &mdash; ConfigFile 1.1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="ConfigFile 1.1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">ConfigFile 1.1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for configfile</h1><div class="highlight"><pre>
<span class="c"># ConfigFile class - Dynamically parse and edit configuration files.</span>
<span class="c"># Copyright (C) 2011-2014 Dario Giovannetti &lt;dev@dariogiovannetti.net&gt;</span>
<span class="c">#</span>
<span class="c"># This program is free software: you can redistribute it and/or modify</span>
<span class="c"># it under the terms of the GNU General Public License as published by</span>
<span class="c"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c"># (at your option) any later version.</span>
<span class="c">#</span>
<span class="c"># This program is distributed in the hope that it will be useful,</span>
<span class="c"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c"># GNU General Public License for more details.</span>
<span class="c">#</span>
<span class="c"># You should have received a copy of the GNU General Public License</span>
<span class="c"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ConfigFile class - Dynamically parse and edit configuration files.</span>

<span class="sd">Author: Dario Giovannetti &lt;dev@dariogiovannetti.net&gt;</span>

<span class="sd">License: GPLv3</span>

<span class="sd">Module contents</span>
<span class="sd">---------------</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">re</span> <span class="kn">as</span> <span class="nn">re_</span>
<span class="kn">import</span> <span class="nn">collections</span>


<div class="viewcode-block" id="Section"><a class="viewcode-back" href="../index.html#configfile.Section">[docs]</a><span class="k">class</span> <span class="nc">Section</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The class for a section in the configuration file.</span>

<span class="sd">    Possible options at the beginning of the file, before any section, are</span>
<span class="sd">    considered to be in the &quot;root&quot; section.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Section.__init__"><a class="viewcode-back" href="../index.html#configfile.Section.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">inherit_options</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                        <span class="n">subsections</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ignore_case</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        name (string): the name of the section</span>
<span class="sd">        parent (Section instance): a reference to the parent section object</span>
<span class="sd">        ignore_case (boolean): if True, section and option names will be</span>
<span class="sd">        compared ignoring case differences; regular expressions will use re.I</span>
<span class="sd">        flag</span>
<span class="sd">        subsections (boolean): if True, subsections are enabled; otherwise they</span>
<span class="sd">        are disabled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_NAME</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_PARENT</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_INHERIT_OPTIONS</span> <span class="o">=</span> <span class="n">inherit_options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ENABLE_SUBSECTIONS</span> <span class="o">=</span> <span class="n">subsections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_IGNORE_CASE</span> <span class="o">=</span> <span class="n">ignore_case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_RE_I</span> <span class="o">=</span> <span class="n">re_</span><span class="o">.</span><span class="n">I</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IGNORE_CASE</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_PARSE_SECTION</span> <span class="o">=</span> <span class="s">&#39;^\s*\[(.+)\]\s*$&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_PARSE_OPTION</span> <span class="o">=</span> <span class="s">&#39;^\s*([^\=]+?)\s*\=\s*(.*?)\s*$&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_PARSE_COMMENT</span> <span class="o">=</span> <span class="s">&#39;^\s*[#;]{1}\s*(.*?)\s*$&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_PARSE_IGNORE</span> <span class="o">=</span> <span class="s">&#39;^\s*$&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ENABLE_SUBSECTIONS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SECTION</span> <span class="o">=</span> <span class="s">&#39;^[a-zA-Z_]+(?:\.?[a-zA-Z0-9_]+)*$&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SECTION</span> <span class="o">=</span> <span class="s">&#39;^[a-zA-Z_]+[a-zA-Z0-9_]*$&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_OPTION</span> <span class="o">=</span> <span class="s">&#39;^[a-zA-Z_]+[a-zA-Z0-9_]*$&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_VALUE</span> <span class="o">=</span> <span class="s">&#39;^.*$&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_SECTION_SEP</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_OPTION_SEP</span> <span class="o">=</span> <span class="s">&#39; = &#39;</span>
        <span class="c"># &quot;{}&quot; will be replaced with the section name by str.format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SECTION_MARKERS</span> <span class="o">=</span> <span class="s">&#39;[{}]&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_COMMENT_MARKER</span> <span class="o">=</span> <span class="s">&#39;# &#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_GET_BOOLEAN_TRUE</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;true&#39;</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;yes&#39;</span><span class="p">,</span> <span class="s">&#39;on&#39;</span><span class="p">,</span> <span class="s">&#39;enabled&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_GET_BOOLEAN_FALSE</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;false&#39;</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="s">&#39;no&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">,</span> <span class="s">&#39;disabled&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_GET_BOOLEAN_DEFAULT</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_DICT_CLASS</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span>

        <span class="c"># Use lambda to create a new object every time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_EMPTY_SECTION</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_DICT_CLASS</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DICT_CLASS</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DICT_CLASS</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DICT_CLASS</span><span class="p">()</span>

    <span class="c">### DATA MODEL ###</span>
</div>
<div class="viewcode-block" id="Section.__call__"><a class="viewcode-back" href="../index.html#configfile.Section.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enables calling directly the object with a string, returning the</span>
<span class="sd">        corresponding subsection object, if existent.</span>

<span class="sd">        key (string): the name of the subsection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lkey</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Section name must be a string: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IGNORE_CASE</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">lkey</span> <span class="o">==</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Section not found: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Section not found: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Section.__getitem__"><a class="viewcode-back" href="../index.html#configfile.Section.__getitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the value for the option specified.</span>

<span class="sd">        opt (string): the name of the option whose value must be returned</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                         <span class="n">inherit_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_INHERIT_OPTIONS</span><span class="p">)</span>
        <span class="c"># self.get returns None as a fallback value if opt is not found:</span>
        <span class="c"># however, for compatibility with usual dictionary operations,</span>
        <span class="c"># __getitem__ should better raise KeyError in this case</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Option not found: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">opt</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">item</span>
</div>
<div class="viewcode-block" id="Section.__setitem__"><a class="viewcode-back" href="../index.html#configfile.Section.__setitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores the provided value in the specified option.</span>

<span class="sd">        Both the option name and the value must be strings.</span>

<span class="sd">        opt (string): the name of the option</span>
<span class="sd">        val (string): the new value for the option</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IGNORE_CASE</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">o</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                            <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Value must be a string: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Option name must be a string: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">opt</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Section.__delitem__"><a class="viewcode-back" href="../index.html#configfile.Section.__delitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes the specified option.</span>

<span class="sd">        opt (string): the name of the option that must be deleted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lopt</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Option name must be a string: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">opt</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IGNORE_CASE</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">o</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">o</span><span class="p">]</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Option not found: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">opt</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Option not found: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">opt</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Section.__iter__"><a class="viewcode-back" href="../index.html#configfile.Section.__iter__">[docs]</a>    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lets iterate over the options of the section (for example with a for</span>
<span class="sd">        loop).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.__contains__"><a class="viewcode-back" href="../index.html#configfile.Section.__contains__">[docs]</a>    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If item is a Section object, this method returns True if item (the</span>
<span class="sd">        object, not its name) is a subsection of self; otherwise this returns</span>
<span class="sd">        True if item is the name of an option in self.</span>

<span class="sd">        item: a Section object or the name of an option</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Section</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IGNORE_CASE</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">o</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span>

    <span class="c">### IMPORTING DATA ###</span>
</div>
<div class="viewcode-block" id="Section.set"><a class="viewcode-back" href="../index.html#configfile.Section.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is an alias for __setitem__().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</div>
<div class="viewcode-block" id="Section.make_subsection"><a class="viewcode-back" href="../index.html#configfile.Section.make_subsection">[docs]</a>    <span class="k">def</span> <span class="nf">make_subsection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an empty subsection under the current section if it doesn&#39;t</span>
<span class="sd">        exist.</span>

<span class="sd">        name (string): the name of the new subsection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_EMPTY_SECTION</span><span class="p">()</span>
        <span class="n">sub</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_EMPTY_SECTION</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_import_object</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.delete"><a class="viewcode-back" href="../index.html#configfile.Section.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the current section.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PARENT</span><span class="o">.</span><span class="n">_subsections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_NAME</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Section.upgrade"><a class="viewcode-back" href="../index.html#configfile.Section.upgrade">[docs]</a>    <span class="k">def</span> <span class="nf">upgrade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">sources</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import sections and options from a file, dictionary or special object</span>
<span class="sd">        with upgrade mode.</span>

<span class="sd">        If an option already exists, change its value; if it doesn&#39;t exist,</span>
<span class="sd">        create it and store its value:</span>
<span class="sd">        {A:a,B:b,C:c} upgrade {A:d,D:e} =&gt; {A:d,B:b,C:c,D:e}</span>

<span class="sd">        See _import_object for object compatibility.</span>

<span class="sd">        sources: a sequence of files, dictionaries and/or special objects.</span>
<span class="sd">        interpolation (boolean): enable/disable value interpolation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Necessary for Python 2 compatibility</span>
        <span class="c"># The Python 3 definition was:</span>
        <span class="c">#def upgrade(self, *sources, interpolation=False):</span>
        <span class="n">interpolation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;interpolation&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_import</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.update"><a class="viewcode-back" href="../index.html#configfile.Section.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">sources</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import sections and options from a file, dictionary or special object</span>
<span class="sd">        with update mode.</span>

<span class="sd">        If an option already exists, change its value; if it doesn&#39;t exist,</span>
<span class="sd">        don&#39;t do anything:</span>
<span class="sd">        {A:a,B:b,C:c} update {A:d,D:e} =&gt; {A:d,B:b,C:c}</span>

<span class="sd">        See _import_object for object compatibility.</span>

<span class="sd">        sources: a sequence of files, dictionaries and/or special objects.</span>
<span class="sd">        interpolation (boolean): enable/disable value interpolation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Necessary for Python 2 compatibility</span>
        <span class="c"># The Python 3 definition was:</span>
        <span class="c">#def upgrade(self, *sources, interpolation=False):</span>
        <span class="n">interpolation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;interpolation&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_import</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.reset"><a class="viewcode-back" href="../index.html#configfile.Section.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">sources</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import sections and options from a file, dictionary or special object</span>
<span class="sd">        with reset mode.</span>

<span class="sd">        Delete all options and subsections and recreate everything from the</span>
<span class="sd">        importing object:</span>
<span class="sd">        {A:a,B:b,C:c} reset {A:d,D:e} =&gt; {A:d,D:e}</span>

<span class="sd">        See _import_object for object compatibility.</span>

<span class="sd">        sources: a sequence of files, dictionaries and/or special objects.</span>
<span class="sd">        interpolation (boolean): enable/disable value interpolation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Necessary for Python 2 compatibility</span>
        <span class="c"># The Python 3 definition was:</span>
        <span class="c">#def upgrade(self, *sources, interpolation=False):</span>
        <span class="n">interpolation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;interpolation&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_import</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.add"><a class="viewcode-back" href="../index.html#configfile.Section.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">sources</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import sections and options from a file, dictionary or special object</span>
<span class="sd">        with add mode.</span>

<span class="sd">        If an option already exists, don&#39;t do anything; if it doesn&#39;t exist,</span>
<span class="sd">        create it and store its value:</span>
<span class="sd">        {A:a,B:b,C:c} add {A:d,D:e} =&gt; {A:a,B:b,C:c,D:e}</span>

<span class="sd">        See _import_object for object compatibility.</span>

<span class="sd">        sources: a sequence of files, dictionaries and/or special objects.</span>
<span class="sd">        interpolation (boolean): enable/disable value interpolation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Necessary for Python 2 compatibility</span>
        <span class="c"># The Python 3 definition was:</span>
        <span class="c">#def upgrade(self, *sources, interpolation=False):</span>
        <span class="n">interpolation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;interpolation&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_import</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section._import"><a class="viewcode-back" href="../index.html#configfile.Section._import">[docs]</a>    <span class="k">def</span> <span class="nf">_import</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                        <span class="n">interpolation</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse some files, dictionaries or special objects and add their</span>
<span class="sd">        configuration to the existing one.</span>

<span class="sd">        Distinction between the various source types is done automatically.</span>

<span class="sd">        sources: a sequence of all the files, dictionaries or special object to</span>
<span class="sd">        be parsed; a value of None will be ignored (useful for creating empty</span>
<span class="sd">        objects that will be populated programmatically).</span>
<span class="sd">        overwrite (bool): this sets whether the next source in the chain</span>
<span class="sd">        overwrites already imported sections and options; see _import_object</span>
<span class="sd">        for more details.</span>
<span class="sd">        add (bool): this sets whether the next source in the chain</span>
<span class="sd">        adds non-pre-existing sections and options; see _import_object for more</span>
<span class="sd">        details.</span>
<span class="sd">        reset (bool): this sets whether the next source in the chain removes</span>
<span class="sd">        all the data added by the previous sources.</span>
<span class="sd">        interpolation (boolean): if True, option values will be interpolated</span>
<span class="sd">        using values from other options through the special syntax</span>
<span class="sd">        ${section$:section$:option$}. Options will be interpolated only once at</span>
<span class="sd">        importing: all links among options will be lost after importing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_file</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">source</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_import_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="n">add</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="n">reset</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">interpolation</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_interpolate</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section._parse_file"><a class="viewcode-back" href="../index.html#configfile.Section._parse_file">[docs]</a>    <span class="k">def</span> <span class="nf">_parse_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse a text file and translate it into a compatible object, thus</span>
<span class="sd">        making it possible to import it.</span>

<span class="sd">        cfile (string): the name of the file to be parsed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfile</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">EnvironmentError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NonExistentFileError</span><span class="p">(</span><span class="s">&#39;Cannot find {} ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                                    <span class="n">e</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">strerror</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidFileError</span><span class="p">(</span><span class="s">&#39;Cannot import configuration from {} &#39;</span>
                                        <span class="s">&#39;({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">strerror</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">stream</span><span class="p">:</span>
                <span class="n">cdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_EMPTY_SECTION</span><span class="p">()</span>
                <span class="n">lastsect</span> <span class="o">=</span> <span class="n">cdict</span>

                <span class="k">for</span> <span class="n">lno</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span>
                    <span class="c"># Note that the order the various types are evaluated</span>
                    <span class="c"># matters!</span>

                    <span class="k">if</span> <span class="n">re_</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_PARSE_IGNORE</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RE_I</span><span class="p">):</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="n">re_</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_PARSE_COMMENT</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RE_I</span><span class="p">):</span>
                        <span class="k">continue</span>

                    <span class="n">re_option</span> <span class="o">=</span> <span class="n">re_</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_PARSE_OPTION</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RE_I</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">re_option</span><span class="p">:</span>
                        <span class="n">lastsect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">re_option</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">re_option</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="n">re_section</span> <span class="o">=</span> <span class="n">re_</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_PARSE_SECTION</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span>
                                                                    <span class="bp">self</span><span class="o">.</span><span class="n">_RE_I</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">re_section</span><span class="p">:</span>
                        <span class="n">subs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_subsections</span><span class="p">(</span><span class="n">re_section</span><span class="p">)</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="n">cdict</span>

                        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subs</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_EMPTY_SECTION</span><span class="p">()</span>

                            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">s</span><span class="p">]</span>

                        <span class="n">lastsect</span> <span class="o">=</span> <span class="n">d</span>
                        <span class="k">continue</span>

                    <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s">&#39;Invalid line in {}: {} (line {})&#39;</span>
                                            <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cfile</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">lno</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">cdict</span>
</div>
<div class="viewcode-block" id="Section._parse_subsections"><a class="viewcode-back" href="../index.html#configfile.Section._parse_subsections">[docs]</a>    <span class="k">def</span> <span class="nf">_parse_subsections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">re</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the sections hierarchy in a section line of a text file and</span>
<span class="sd">        return them in a list.</span>

<span class="sd">        re: regexp object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ENABLE_SUBSECTIONS</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SECTION_SEP</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="Section._import_object"><a class="viewcode-back" href="../index.html#configfile.Section._import_object">[docs]</a>    <span class="k">def</span> <span class="nf">_import_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cobj</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import sections and options from a compatible object.</span>

<span class="sd">        cobj (special nested object): a special object composed of</span>
<span class="sd">        dictionaries (or compatible mapping object) and tuples to be imported;</span>
<span class="sd">        a section is represented by a 2-tuple: its first value is a mapping</span>
<span class="sd">        object that associates the names of options to their values; its second</span>
<span class="sd">        value is a mapping object that associates the names of subsections to</span>
<span class="sd">        their 2-tuples. For example:</span>
<span class="sd">        cobj = (</span>
<span class="sd">            {</span>
<span class="sd">                &#39;option1&#39;: &#39;value&#39;,</span>
<span class="sd">                &#39;option2&#39;: &#39;value&#39;</span>
<span class="sd">            },</span>
<span class="sd">            {</span>
<span class="sd">                &#39;sectionA&#39;: (</span>
<span class="sd">                    {</span>
<span class="sd">                        &#39;optionA1&#39;: &#39;value&#39;,</span>
<span class="sd">                        &#39;optionA2&#39;: &#39;value&#39;,</span>
<span class="sd">                    },</span>
<span class="sd">                    {</span>
<span class="sd">                        &#39;sectionC&#39;: (</span>
<span class="sd">                            {</span>
<span class="sd">                                &#39;optionC1&#39;: &#39;value&#39;,</span>
<span class="sd">                                &#39;optionC2&#39;: &#39;value&#39;,</span>
<span class="sd">                            },</span>
<span class="sd">                            {},</span>
<span class="sd">                        ),</span>
<span class="sd">                    },</span>
<span class="sd">                ),</span>
<span class="sd">                &#39;sectionB&#39;: (</span>
<span class="sd">                    {</span>
<span class="sd">                        &#39;optionB1&#39;: &#39;value&#39;,</span>
<span class="sd">                        &#39;optionB2&#39;: &#39;value&#39;</span>
<span class="sd">                    },</span>
<span class="sd">                    {},</span>
<span class="sd">                ),</span>
<span class="sd">            },</span>
<span class="sd">        )</span>

<span class="sd">        overwrite (bool): whether imported data will overwrite pre-existing</span>
<span class="sd">        data.</span>
<span class="sd">        add (bool): whether non-pre-existing data will be imported.</span>
<span class="sd">        reset (bool): whether pre-existing data will be cleared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">reset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DICT_CLASS</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DICT_CLASS</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">cobj</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cobj</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">o</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> \
                                <span class="n">re_</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_OPTION</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RE_I</span><span class="p">)</span> <span class="ow">and</span> \
                                <span class="n">re_</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_VALUE</span><span class="p">,</span> <span class="n">cobj</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">o</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RE_I</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_import_object_option</span><span class="p">(</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">reset</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span>
                                                                    <span class="n">cobj</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">o</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidObjectError</span><span class="p">(</span><span class="s">&#39;Invalid option or value: {}: {}&#39;</span>
                                                    <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">cobj</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">o</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cobj</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re_</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SECTION</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RE_I</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_import_object_subsection</span><span class="p">(</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">reset</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span>
                                                                    <span class="n">cobj</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">s</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidObjectError</span><span class="p">(</span><span class="s">&#39;Invalid section name: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Section._import_object_option"><a class="viewcode-back" href="../index.html#configfile.Section._import_object_option">[docs]</a>    <span class="k">def</span> <span class="nf">_import_object_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">reset</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Auxiliary method for _import_object().</span>

<span class="sd">        Import the currently-examined option.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">reset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IGNORE_CASE</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">o</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="c"># Don&#39;t even think of merging these two tests</span>
                    <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                        <span class="k">return</span> <span class="bp">True</span>

                    <span class="k">break</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Going through the loop above makes sure the option is not yet</span>
                <span class="c">#  in the section</span>
                <span class="k">if</span> <span class="n">add</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="k">return</span> <span class="bp">True</span>

        <span class="k">elif</span> <span class="n">opt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">:</span>
            <span class="c"># Don&#39;t even think of merging these two tests</span>
            <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">return</span> <span class="bp">True</span>

        <span class="k">elif</span> <span class="n">add</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="Section._import_object_subsection"><a class="viewcode-back" href="../index.html#configfile.Section._import_object_subsection">[docs]</a>    <span class="k">def</span> <span class="nf">_import_object_subsection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">reset</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">secd</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Auxiliary method for _import_object().</span>

<span class="sd">        Import the currently-examined subsection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">reset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_import_object_subsection_create</span><span class="p">(</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">secd</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IGNORE_CASE</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sec</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">ss</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="c"># Don&#39;t test overwrite here</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="o">.</span><span class="n">_import_object</span><span class="p">(</span><span class="n">secd</span><span class="p">,</span>
                                                <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="n">add</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">True</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Going through the loop above makes sure the section is not</span>
                <span class="c">#  yet a subsection of the visited section</span>
                <span class="k">if</span> <span class="n">add</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_import_object_subsection_create</span><span class="p">(</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span>
                                                                        <span class="n">secd</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">True</span>

        <span class="k">elif</span> <span class="n">sec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="p">:</span>
            <span class="c"># Don&#39;t test overwrite here</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="p">[</span><span class="n">sec</span><span class="p">]</span><span class="o">.</span><span class="n">_import_object</span><span class="p">(</span><span class="n">secd</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span>
                                                                    <span class="n">add</span><span class="o">=</span><span class="n">add</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">elif</span> <span class="n">add</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_import_object_subsection_create</span><span class="p">(</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">secd</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="Section._import_object_subsection_create"><a class="viewcode-back" href="../index.html#configfile.Section._import_object_subsection_create">[docs]</a>    <span class="k">def</span> <span class="nf">_import_object_subsection_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">secd</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Auxiliary method for _import_object_subsection().</span>

<span class="sd">        Import the currently-examined subsection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subsection</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">sec</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                             <span class="n">inherit_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_INHERIT_OPTIONS</span><span class="p">,</span>
                             <span class="n">subsections</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ENABLE_SUBSECTIONS</span><span class="p">,</span>
                             <span class="n">ignore_case</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_IGNORE_CASE</span><span class="p">)</span>
        <span class="n">subsection</span><span class="o">.</span><span class="n">_import_object</span><span class="p">(</span><span class="n">secd</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="n">add</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="p">[</span><span class="n">sec</span><span class="p">]</span> <span class="o">=</span> <span class="n">subsection</span>
</div>
<div class="viewcode-block" id="Section._interpolate"><a class="viewcode-back" href="../index.html#configfile.Section._interpolate">[docs]</a>    <span class="k">def</span> <span class="nf">_interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interpolate values among different options.</span>

<span class="sd">        root: the root section from which resolve interpolations.</span>

<span class="sd">        The &#39;$&#39; sign is a special character: a &#39;$&#39; not followed by &#39;$&#39;, &#39;{&#39;,</span>
<span class="sd">        &#39;:&#39; or &#39;}&#39; will be left &#39;$&#39;; &#39;$$&#39; will be translated as &#39;$&#39; both inside</span>
<span class="sd">        or outside an interpolation path; &#39;${&#39; will be considered as the</span>
<span class="sd">        beginning of an interpolation path, unless it&#39;s found inside another</span>
<span class="sd">        interpolation path, and in the latter case it will be left &#39;${&#39;; &#39;$:&#39;</span>
<span class="sd">        will be considered as a separator between sections of an interpolation</span>
<span class="sd">        path, unless it&#39;s found outside of an interpolation path, and in the</span>
<span class="sd">        latter case it will be left &#39;$:&#39;; &#39;$}&#39; will be considered as the end of</span>
<span class="sd">        an interpolation path, unless it&#39;s found outside of an interpolation</span>
<span class="sd">        path, and in the latter case it will be left &#39;$}&#39;.</span>
<span class="sd">        Normally all paths will be resolved based on the root section of the</span>
<span class="sd">        file; anyway, if the interpolation path has only one item, it will be</span>
<span class="sd">        resolved as an option relative to the current section; otherwise, if</span>
<span class="sd">        the path starts with &#39;$:&#39;, the first item will be considered as a</span>
<span class="sd">        section (or an option, if last in the list) relative to the current</span>
<span class="sd">        section.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">:</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">re_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;(\$\$|\$\{|\$\:|\$\})&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="n">resolve</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">L</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s">&#39;$$&#39;</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="s">&#39;$&#39;</span>

                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s">&#39;${&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">resolve</span><span class="p">:</span>
                    <span class="n">resolve</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s">&#39;$:&#39;</span> <span class="ow">and</span> <span class="n">resolve</span><span class="p">:</span>
                    <span class="n">resolve</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s">&#39;$}&#39;</span> <span class="ow">and</span> <span class="n">resolve</span><span class="p">:</span>
                    <span class="n">option</span> <span class="o">=</span> <span class="n">resolve</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resolve</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">resolve</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">section</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">_subsections</span><span class="p">[</span><span class="n">resolve</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resolve</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                        <span class="n">section</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">_subsections</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>

                    <span class="n">i</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">option</span><span class="p">]</span>
                    <span class="n">resolve</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">continue</span>

                <span class="k">elif</span> <span class="n">resolve</span><span class="p">:</span>
                    <span class="n">resolve</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">i</span>

            <span class="n">v</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">ss</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="p">:</span>
            <span class="n">ss</span><span class="o">.</span><span class="n">_interpolate</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>

    <span class="c">### EXPORTING DATA ###</span>
</div>
<div class="viewcode-block" id="Section.get"><a class="viewcode-back" href="../index.html#configfile.Section.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">inherit_options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the value for the option specified.</span>

<span class="sd">        opt (string): the name of the option whose value must be returned</span>
<span class="sd">        fallback (string, None): if set to a string, and the option is not</span>
<span class="sd">        found, this method returns that string; if set to None (default) it</span>
<span class="sd">        returns KeyError</span>
<span class="sd">        inherit_options (boolean): if True, if the option is not found in the</span>
<span class="sd">        current section, it&#39;s searched in the parent sections; note that this</span>
<span class="sd">        can be set as a default for the object, but this setting overwrites it</span>
<span class="sd">        only for this call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inherit_options</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="n">inherit_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_INHERIT_OPTIONS</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">slist</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">,</span> <span class="p">]</span>

            <span class="k">if</span> <span class="n">inherit_options</span><span class="p">:</span>
                <span class="n">slist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_ancestors</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">slist</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">_options</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_IGNORE_CASE</span> <span class="ow">and</span> <span class="n">opt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">o</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="ow">or</span> \
                                          <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IGNORE_CASE</span> <span class="ow">and</span> <span class="n">opt</span> <span class="o">==</span> <span class="n">o</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">o</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Note that if fallback is not specified, this returns None</span>
                <span class="c"># which is not a string as expected</span>
                <span class="k">return</span> <span class="n">fallback</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Option name must be a string: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">opt</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Section.get_str"><a class="viewcode-back" href="../index.html#configfile.Section.get_str">[docs]</a>    <span class="k">def</span> <span class="nf">get_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">inherit_options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is an alias for get().</span>

<span class="sd">        This will always return a string.</span>

<span class="sd">        opt (string): the name of the option whose value must be returned</span>
<span class="sd">        fallback (string, None): if set to a string, and the option is not</span>
<span class="sd">        found, this method returns that string; if set to None (default) it</span>
<span class="sd">        returns KeyError</span>
<span class="sd">        inherit_options (boolean): if True, if the option is not found in the</span>
<span class="sd">        current section, it&#39;s searched in the parent sections; note that this</span>
<span class="sd">        can be set as a default for the object, but this setting overwrites it</span>
<span class="sd">        only for this call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inherit_options</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="n">inherit_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_INHERIT_OPTIONS</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="n">fallback</span><span class="p">,</span>
                                              <span class="n">inherit_options</span><span class="o">=</span><span class="n">inherit_options</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.get_int"><a class="viewcode-back" href="../index.html#configfile.Section.get_int">[docs]</a>    <span class="k">def</span> <span class="nf">get_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">inherit_options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method tries to return an integer from the value of an option.</span>

<span class="sd">        opt (string): the name of the option whose value must be returned</span>
<span class="sd">        fallback (string, None): if set to a string, and the option is not</span>
<span class="sd">        found, this method returns that string; if set to None (default) it</span>
<span class="sd">        returns KeyError</span>
<span class="sd">        inherit_options (boolean): if True, if the option is not found in the</span>
<span class="sd">        current section, it&#39;s searched in the parent sections; note that this</span>
<span class="sd">        can be set as a default for the object, but this setting overwrites it</span>
<span class="sd">        only for this call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inherit_options</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="n">inherit_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_INHERIT_OPTIONS</span>

        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="n">fallback</span><span class="p">,</span>
                                             <span class="n">inherit_options</span><span class="o">=</span><span class="n">inherit_options</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Section.get_float"><a class="viewcode-back" href="../index.html#configfile.Section.get_float">[docs]</a>    <span class="k">def</span> <span class="nf">get_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">inherit_options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method tries to return a float from the value of an option.</span>

<span class="sd">        opt (string): the name of the option whose value must be returned</span>
<span class="sd">        fallback (string, None): if set to a string, and the option is not</span>
<span class="sd">        found, this method returns that string; if set to None (default) it</span>
<span class="sd">        returns KeyError</span>
<span class="sd">        inherit_options (boolean): if True, if the option is not found in the</span>
<span class="sd">        current section, it&#39;s searched in the parent sections; note that this</span>
<span class="sd">        can be set as a default for the object, but this setting overwrites it</span>
<span class="sd">        only for this call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inherit_options</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="n">inherit_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_INHERIT_OPTIONS</span>

        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="n">fallback</span><span class="p">,</span>
                                             <span class="n">inherit_options</span><span class="o">=</span><span class="n">inherit_options</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Section.get_bool"><a class="viewcode-back" href="../index.html#configfile.Section.get_bool">[docs]</a>    <span class="k">def</span> <span class="nf">get_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">true</span><span class="o">=</span><span class="p">(),</span> <span class="n">false</span><span class="o">=</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                                         <span class="n">inherit_options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method tries to return a boolean status (True or False) from the</span>
<span class="sd">        value of an option.</span>

<span class="sd">        opt (string): the name of the option whose value must be returned</span>
<span class="sd">        true (tuple): a tuple with the strings to be recognized as True</span>
<span class="sd">        false (tuple): a tuple with the strings to be recognized as False</span>
<span class="sd">        default: if the value is neither in true nor in false tuples, return</span>
<span class="sd">        this boolean status; if set to None, it raises a ValueError exception</span>
<span class="sd">        fallback: if set to None (default), and the option is not found, it</span>
<span class="sd">        raises KeyError; otherwise this value is evaluated with the true and</span>
<span class="sd">        false tuples, or the default value</span>
<span class="sd">        inherit_options (boolean): if True, if the option is not found in the</span>
<span class="sd">        current section, it&#39;s searched in the parent sections; note that this</span>
<span class="sd">        can be set as a default for the object, but this setting overwrites it</span>
<span class="sd">        only for this call</span>

<span class="sd">        Note that the characters in the strings are compared in lowercase, so</span>
<span class="sd">        there&#39;s no need to specify all casing variations of a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">true</span> <span class="o">==</span> <span class="p">():</span>
            <span class="n">true</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GET_BOOLEAN_TRUE</span>
        <span class="k">if</span> <span class="n">false</span> <span class="o">==</span> <span class="p">():</span>
            <span class="n">false</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GET_BOOLEAN_FALSE</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GET_BOOLEAN_DEFAULT</span>
        <span class="k">if</span> <span class="n">inherit_options</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="n">inherit_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_INHERIT_OPTIONS</span>

        <span class="n">v</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="n">fallback</span><span class="p">,</span>
                                      <span class="n">inherit_options</span><span class="o">=</span><span class="n">inherit_options</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">true</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">false</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">default</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">default</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Unrecognized boolean status: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                                                    <span class="bp">self</span><span class="p">[</span><span class="n">opt</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="Section._get_ancestors"><a class="viewcode-back" href="../index.html#configfile.Section._get_ancestors">[docs]</a>    <span class="k">def</span> <span class="nf">_get_ancestors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list with the ancestors of the current section, but not the</span>
<span class="sd">        current section itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">slist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PARENT</span>

        <span class="k">while</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">slist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">_PARENT</span>

        <span class="k">return</span> <span class="n">slist</span>
</div>
<div class="viewcode-block" id="Section._get_descendants"><a class="viewcode-back" href="../index.html#configfile.Section._get_descendants">[docs]</a>    <span class="k">def</span> <span class="nf">_get_descendants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list with the descendants of the current section, but not the</span>
<span class="sd">        current section itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Don&#39;t do `slist = self._subsections.values()` because the descendants</span>
        <span class="c">#  for each subsection must be appended after the proper subsection,</span>
        <span class="c">#  not at the end of the list</span>
        <span class="n">slist</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">slist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
            <span class="n">slist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">_get_descendants</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">slist</span>
</div>
<div class="viewcode-block" id="Section.get_options"><a class="viewcode-back" href="../index.html#configfile.Section.get_options">[docs]</a>    <span class="k">def</span> <span class="nf">get_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">inherit_options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dictionary with a copy of option names as keys and their</span>
<span class="sd">        values as values.</span>

<span class="sd">        ordered (boolean): if True, return an ordered dictionary; otherwise</span>
<span class="sd">        return a normal dictionary</span>
<span class="sd">        inherit_options (boolean): if True, options are searched also in the</span>
<span class="sd">        parent sections; note that this can be set as a default for the object,</span>
<span class="sd">        but this setting overwrites it only for this call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inherit_options</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="n">inherit_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_INHERIT_OPTIONS</span>

        <span class="k">if</span> <span class="n">ordered</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DICT_CLASS</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">slist</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">,</span> <span class="p">]</span>

        <span class="k">if</span> <span class="n">inherit_options</span><span class="p">:</span>
            <span class="n">slist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_ancestors</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">slist</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">_options</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">o</span><span class="p">][:]</span>
                <span class="c"># There should be no need to check _IGNORE_CASE, in fact it has</span>
                <span class="c"># already been done at importing time</span>

        <span class="k">return</span> <span class="n">d</span>
</div>
<div class="viewcode-block" id="Section.get_sections"><a class="viewcode-back" href="../index.html#configfile.Section.get_sections">[docs]</a>    <span class="k">def</span> <span class="nf">get_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list with a copy of the names of the child sections.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Section.get_tree"><a class="viewcode-back" href="../index.html#configfile.Section.get_tree">[docs]</a>    <span class="k">def</span> <span class="nf">get_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a compatible object with options and subsections.</span>

<span class="sd">        ordered (boolean): if True, the object uses ordered dictionaries;</span>
<span class="sd">        otherwise it uses normal dictionaries</span>
<span class="sd">        path (boolean): if True, return the current section as a subsection</span>
<span class="sd">        of the parent sections.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recurse_tree</span><span class="p">(</span><span class="n">ordered</span><span class="o">=</span><span class="n">ordered</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PARENT</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NAME</span>

            <span class="k">while</span> <span class="n">p</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ordered</span><span class="p">:</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_EMPTY_SECTION</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="p">({},</span> <span class="p">{})</span>

                <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">e</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">_NAME</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">_PARENT</span>

        <span class="k">return</span> <span class="n">d</span>
</div>
<div class="viewcode-block" id="Section._recurse_tree"><a class="viewcode-back" href="../index.html#configfile.Section._recurse_tree">[docs]</a>    <span class="k">def</span> <span class="nf">_recurse_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Auxiliary recursor for get_tree().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_options</span><span class="p">(</span><span class="n">ordered</span><span class="o">=</span><span class="n">ordered</span><span class="p">,</span> <span class="n">inherit_options</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ordered</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DICT_CLASS</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subsections</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">_recurse_tree</span><span class="p">(</span><span class="n">ordered</span><span class="o">=</span><span class="n">ordered</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">d</span>
</div>
<div class="viewcode-block" id="Section._export"><a class="viewcode-back" href="../index.html#configfile.Section._export">[docs]</a>    <span class="k">def</span> <span class="nf">_export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                                    <span class="n">path</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the configuration to one or more files.</span>

<span class="sd">        targets: a sequence with the target file names</span>
<span class="sd">        overwrite (bool): this sets whether sections and options in the</span>
<span class="sd">        file are overwritten; see _import_object for more details.</span>
<span class="sd">        add (bool): this sets whether non-pre-existing sections and option</span>
<span class="sd">        are added; see _import_object for more details.</span>
<span class="sd">        path (boolean): if True, section names are exported with their full</span>
<span class="sd">        path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_export_file</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="n">add</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="n">reset</span><span class="p">,</span>
                                                                    <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.export_upgrade"><a class="viewcode-back" href="../index.html#configfile.Section.export_upgrade">[docs]</a>    <span class="k">def</span> <span class="nf">export_upgrade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">targets</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export sections and options to one or more files with upgrade mode.</span>

<span class="sd">        If an option already exists, change its value; if it doesn&#39;t exist,</span>
<span class="sd">        create it and store its value:</span>
<span class="sd">        {A:d,D:e} upgrade {A:a,B:b,C:c} =&gt; {A:d,B:b,C:c,D:e}</span>

<span class="sd">        See _export_file for object compatibility.</span>

<span class="sd">        targets: a sequence with the target file names</span>
<span class="sd">        path (boolean): if True, section names are exported with their full</span>
<span class="sd">        path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Necessary for Python 2 compatibility</span>
        <span class="c"># The Python 3 definition was:</span>
        <span class="c">#def export_upgrade(self, *targets, path=True):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_export</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.export_update"><a class="viewcode-back" href="../index.html#configfile.Section.export_update">[docs]</a>    <span class="k">def</span> <span class="nf">export_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">targets</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export sections and options to one or more files with update mode.</span>

<span class="sd">        If an option already exists, change its value; if it doesn&#39;t exist,</span>
<span class="sd">        don&#39;t do anything:</span>
<span class="sd">        {A:d,D:e} update {A:a,B:b,C:c} =&gt; {A:d,B:b,C:c}</span>

<span class="sd">        See _export_file for object compatibility.</span>

<span class="sd">        targets: a sequence with the target file names</span>
<span class="sd">        path (boolean): if True, section names are exported with their full</span>
<span class="sd">        path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Necessary for Python 2 compatibility</span>
        <span class="c"># The Python 3 definition was:</span>
        <span class="c">#def export_upgrade(self, *targets, path=True):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_export</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.export_reset"><a class="viewcode-back" href="../index.html#configfile.Section.export_reset">[docs]</a>    <span class="k">def</span> <span class="nf">export_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">targets</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export sections and options to one or more files with reset mode.</span>

<span class="sd">        Delete all options and subsections and recreate everything from the</span>
<span class="sd">        importing object:</span>
<span class="sd">        {A:d,D:e} reset {A:a,B:b,C:c} =&gt; {A:d,D:e}</span>

<span class="sd">        See _export_file for object compatibility.</span>

<span class="sd">        targets: a sequence with the target file names</span>
<span class="sd">        path (boolean): if True, section names are exported with their full</span>
<span class="sd">        path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Necessary for Python 2 compatibility</span>
        <span class="c"># The Python 3 definition was:</span>
        <span class="c">#def export_upgrade(self, *targets, path=True):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_export</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.export_add"><a class="viewcode-back" href="../index.html#configfile.Section.export_add">[docs]</a>    <span class="k">def</span> <span class="nf">export_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">targets</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export sections and options to one or more files with add mode.</span>

<span class="sd">        If an option already exists, don&#39;t do anything; if it doesn&#39;t exist,</span>
<span class="sd">        create it and store its value:</span>
<span class="sd">        {A:d,D:e} add {A:a,B:b,C:c} =&gt; {A:a,B:b,C:c,D:e}</span>

<span class="sd">        See _export_file for object compatibility.</span>

<span class="sd">        targets: a sequence with the target file names</span>
<span class="sd">        path (boolean): if True, section names are exported with their full</span>
<span class="sd">        path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Necessary for Python 2 compatibility</span>
        <span class="c"># The Python 3 definition was:</span>
        <span class="c">#def export_upgrade(self, *targets, path=True):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_export</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section._export_file"><a class="viewcode-back" href="../index.html#configfile.Section._export_file">[docs]</a>    <span class="k">def</span> <span class="nf">_export_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfile</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                                    <span class="n">path</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the sections tree to a file.</span>

<span class="sd">        efile (string): the target file name.</span>
<span class="sd">        overwrite (bool): whether sections and options already existing in the</span>
<span class="sd">        file are overwritten.</span>
<span class="sd">        add (bool): whether non-pre-existing data will be exported.</span>
<span class="sd">        path (boolean): if True, section names are exported with their full</span>
<span class="sd">        path, otherwise they are left</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfile</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Exclude leading blank lines</span>
            <span class="k">for</span> <span class="n">lineN</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">re_</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_PARSE_IGNORE</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RE_I</span><span class="p">):</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">lineN</span><span class="p">:]</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfile</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
            <span class="n">BASE_SECTION</span> <span class="o">=</span> <span class="bp">self</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">ROOT_SECTION</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ancestors</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">ROOT_SECTION</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="n">readonly_section</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">remaining_descendants</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
                    <span class="n">readonly_section</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">remaining_descendants</span> <span class="o">=</span> <span class="p">[</span><span class="n">BASE_SECTION</span><span class="p">,</span> <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># The options without a section (i.e. at the top of the</span>
                    <span class="c">#  file) must be considered part of the current section if</span>
                    <span class="c">#  path is False</span>
                    <span class="n">readonly_section</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="n">remaining_descendants</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">remaining_options</span> <span class="o">=</span> <span class="n">BASE_SECTION</span><span class="o">.</span><span class="n">get_options</span><span class="p">(</span><span class="n">inherit_options</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">remaining_descendants</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">BASE_SECTION</span><span class="o">.</span><span class="n">_get_descendants</span><span class="p">())</span>
            <span class="n">other_lines</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">re_option</span> <span class="o">=</span> <span class="n">re_</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_PARSE_OPTION</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RE_I</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">re_option</span><span class="p">:</span>
                    <span class="c"># This also changes other_lines in place</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_export_other_lines</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">other_lines</span><span class="p">,</span>
                                                    <span class="n">readonly_section</span><span class="p">,</span> <span class="n">reset</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_export_file_existing_option</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re_option</span><span class="p">,</span>
                                        <span class="n">readonly_section</span><span class="p">,</span> <span class="n">remaining_options</span><span class="p">,</span>
                                        <span class="n">overwrite</span><span class="p">,</span> <span class="n">reset</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="n">re_section</span> <span class="o">=</span> <span class="n">re_</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_PARSE_SECTION</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_RE_I</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">re_section</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">add</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_export_file_remaining_options</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span>
                                        <span class="n">readonly_section</span><span class="p">,</span> <span class="n">remaining_options</span><span class="p">)</span>

                    <span class="c"># This also changes other_lines in place</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_export_other_lines_before_existing_section</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span>
                                        <span class="n">other_lines</span><span class="p">,</span> <span class="n">readonly_section</span><span class="p">,</span> <span class="n">reset</span><span class="p">)</span>

                    <span class="c"># This also changes remaining_descendants in place</span>
                    <span class="p">(</span><span class="n">readonly_section</span><span class="p">,</span> <span class="n">remaining_options</span><span class="p">)</span> <span class="o">=</span> \
                                            <span class="bp">self</span><span class="o">.</span><span class="n">_export_file_existing_section</span><span class="p">(</span>
                                            <span class="n">stream</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re_section</span><span class="p">,</span>
                                            <span class="n">ROOT_SECTION</span><span class="p">,</span> <span class="n">BASE_SECTION</span><span class="p">,</span>
                                            <span class="n">remaining_descendants</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c"># Comments, ignored/invalid lines</span>
                <span class="n">other_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">add</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_export_file_remaining_options</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">readonly_section</span><span class="p">,</span>
                                                            <span class="n">remaining_options</span><span class="p">)</span>

            <span class="c"># Don&#39;t use _export_other_lines_before_existing_section here</span>
            <span class="c">#  because any pre-existing unrecognized lines must be restored in</span>
            <span class="c">#  any case, and since they&#39;re at the end of the original file,</span>
            <span class="c">#  they weren&#39;t meant to separate any further sections, so let</span>
            <span class="c">#  _export_file_remaining_sections handle the addition of a blank</span>
            <span class="c">#  line</span>
            <span class="c"># This also changes other_lines in place</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_export_other_lines</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">other_lines</span><span class="p">,</span> <span class="n">readonly_section</span><span class="p">,</span>
                                                                        <span class="n">reset</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">add</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_export_file_remaining_sections</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">BASE_SECTION</span><span class="p">,</span>
                                                <span class="n">remaining_descendants</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section._export_file_existing_option"><a class="viewcode-back" href="../index.html#configfile.Section._export_file_existing_option">[docs]</a>    <span class="k">def</span> <span class="nf">_export_file_existing_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re_option</span><span class="p">,</span>
                        <span class="n">readonly_section</span><span class="p">,</span> <span class="n">remaining_options</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">,</span> <span class="n">reset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Auxiliary method for _export_file().</span>

<span class="sd">        Write the option currently examined from the destination file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">readonly_section</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IGNORE_CASE</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">remaining_options</span><span class="p">:</span>
                <span class="n">fkey</span> <span class="o">=</span> <span class="n">re_option</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">fvalue</span> <span class="o">=</span> <span class="n">re_option</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">fkey</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">option</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">fvalue</span> <span class="o">!=</span> <span class="n">remaining_options</span><span class="p">[</span><span class="n">option</span><span class="p">]:</span>
                        <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">fkey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_OPTION_SEP</span><span class="p">,</span>
                                            <span class="n">remaining_options</span><span class="p">[</span><span class="n">option</span><span class="p">],</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                    <span class="k">del</span> <span class="n">remaining_options</span><span class="p">[</span><span class="n">option</span><span class="p">]</span>

                    <span class="c"># There shouldn&#39;t be more occurrences of this option (even</span>
                    <span class="c">#  with different casing)</span>
                    <span class="k">return</span> <span class="bp">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">fkey</span> <span class="o">=</span> <span class="n">re_option</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fvalue</span> <span class="o">=</span> <span class="n">re_option</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">fkey</span> <span class="ow">in</span> <span class="n">remaining_options</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">remaining_options</span><span class="p">[</span><span class="n">fkey</span><span class="p">]</span> <span class="o">!=</span> <span class="n">fvalue</span><span class="p">:</span>
                    <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">fkey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_OPTION_SEP</span><span class="p">,</span>
                                            <span class="n">remaining_options</span><span class="p">[</span><span class="n">fkey</span><span class="p">],</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)))</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                <span class="k">del</span> <span class="n">remaining_options</span><span class="p">[</span><span class="n">fkey</span><span class="p">]</span>
                <span class="k">return</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">reset</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="Section._export_file_remaining_options"><a class="viewcode-back" href="../index.html#configfile.Section._export_file_remaining_options">[docs]</a>    <span class="k">def</span> <span class="nf">_export_file_remaining_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">readonly_section</span><span class="p">,</span>
                                                            <span class="n">remaining_options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Auxiliary method for _export_file().</span>

<span class="sd">        Write the options from the origin object that were not found in the</span>
<span class="sd">        destination file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">readonly_section</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">remaining_options</span><span class="p">:</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">option</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_OPTION_SEP</span><span class="p">,</span>
                                            <span class="n">remaining_options</span><span class="p">[</span><span class="n">option</span><span class="p">],</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="Section._export_file_existing_section"><a class="viewcode-back" href="../index.html#configfile.Section._export_file_existing_section">[docs]</a>    <span class="k">def</span> <span class="nf">_export_file_existing_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re_section</span><span class="p">,</span>
                    <span class="n">ROOT_SECTION</span><span class="p">,</span> <span class="n">BASE_SECTION</span><span class="p">,</span> <span class="n">remaining_descendants</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Auxiliary method for _export_file().</span>

<span class="sd">        Write the section currently examined from the destination file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ENABLE_SUBSECTIONS</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">re_section</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SECTION_SEP</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">(</span><span class="n">re_section</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">)</span>

        <span class="n">current_section</span> <span class="o">=</span> <span class="n">ROOT_SECTION</span> <span class="k">if</span> <span class="n">path</span> <span class="k">else</span> <span class="n">BASE_SECTION</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">current_section</span> <span class="o">=</span> <span class="n">current_section</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c"># The currently parsed section is not in the configuration</span>
                <span class="c">#  object</span>
                <span class="n">readonly_section</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">remaining_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DICT_CLASS</span><span class="p">()</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alist</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_section</span><span class="p">,</span> <span class="p">]</span>
            <span class="n">alist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">current_section</span><span class="o">.</span><span class="n">_get_ancestors</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">BASE_SECTION</span> <span class="ow">in</span> <span class="n">alist</span><span class="p">:</span>
                <span class="n">readonly_section</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">remaining_options</span> <span class="o">=</span> <span class="n">current_section</span><span class="o">.</span><span class="n">get_options</span><span class="p">(</span>
                                                        <span class="n">inherit_options</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">remaining_descendants</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">current_section</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">readonly_section</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">remaining_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DICT_CLASS</span><span class="p">()</span>

        <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">readonly_section</span><span class="p">,</span> <span class="n">remaining_options</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section._export_file_remaining_sections"><a class="viewcode-back" href="../index.html#configfile.Section._export_file_remaining_sections">[docs]</a>    <span class="k">def</span> <span class="nf">_export_file_remaining_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">BASE_SECTION</span><span class="p">,</span>
                                                <span class="n">remaining_descendants</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Auxiliary method for _export_file().</span>

<span class="sd">        Write the sections and their options from the origin object that</span>
<span class="sd">        were not found in the destination file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Do not add an empty line if at the start of the file</span>
        <span class="n">BR</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="k">if</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">&quot;&quot;</span>

        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">remaining_descendants</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">_options</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ancestors</span> <span class="o">=</span> <span class="p">[</span><span class="n">section</span><span class="o">.</span><span class="n">_NAME</span><span class="p">,</span> <span class="p">]</span>

                <span class="k">for</span> <span class="n">ancestor</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">_get_ancestors</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">ancestor</span> <span class="ow">is</span> <span class="n">BASE_SECTION</span><span class="p">:</span>
                        <span class="k">break</span>

                    <span class="n">ancestors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ancestor</span><span class="o">.</span><span class="n">_NAME</span><span class="p">)</span>

                <span class="n">ancestors</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

                <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">BR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SECTION_MARKERS</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                                <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SECTION_SEP</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ancestors</span><span class="p">)))</span>

                <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">_options</span><span class="p">:</span>
                    <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">option</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_OPTION_SEP</span><span class="p">,</span>
                                                    <span class="n">section</span><span class="p">[</span><span class="n">option</span><span class="p">],</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)))</span>

                <span class="c"># All the subsequent sections will need a blank line in any</span>
                <span class="c">#  case (do not add a double line break after the last option</span>
                <span class="c">#  because the last option of the last section must have only</span>
                <span class="c">#  one break)</span>
                <span class="n">BR</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
</div>
<div class="viewcode-block" id="Section._export_other_lines"><a class="viewcode-back" href="../index.html#configfile.Section._export_other_lines">[docs]</a>    <span class="k">def</span> <span class="nf">_export_other_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">other_lines</span><span class="p">,</span> <span class="n">readonly_section</span><span class="p">,</span>
                                                                        <span class="n">reset</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">readonly_section</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">reset</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">other_lines</span><span class="p">)</span>

        <span class="n">other_lines</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="Section._export_other_lines_before_existing_section"><a class="viewcode-back" href="../index.html#configfile.Section._export_other_lines_before_existing_section">[docs]</a>    <span class="k">def</span> <span class="nf">_export_other_lines_before_existing_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">other_lines</span><span class="p">,</span>
                                                    <span class="n">readonly_section</span><span class="p">,</span> <span class="n">reset</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">readonly_section</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">reset</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">other_lines</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">other_lines</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span>

</div></div>
<div class="viewcode-block" id="ConfigFile"><a class="viewcode-back" href="../index.html#configfile.ConfigFile">[docs]</a><span class="k">class</span> <span class="nc">ConfigFile</span><span class="p">(</span><span class="n">Section</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A configuration file object.</span>

<span class="sd">    One or more text files, dictionaries or compatible objects can be initially</span>
<span class="sd">    parsed with configfile.ConfigFile(file1, dict1, file2, ...).</span>
<span class="sd">    This will instantiate a ConfigFile object with sections, subsections,</span>
<span class="sd">    options and values.</span>
<span class="sd">    Even if you parse more files, dictionaries or special objects, this will</span>
<span class="sd">    instantiate a unified object.</span>

<span class="sd">    A default set of values can be set by assigning a dictionary as the first</span>
<span class="sd">    argument.</span>

<span class="sd">    By default, sections are allowed to contain both options or other sections</span>
<span class="sd">    (subsections): this behaviour can be disabled by instantiating ConfigFile</span>
<span class="sd">    with sub=False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ConfigFile.__init__"><a class="viewcode-back" href="../index.html#configfile.ConfigFile.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">sources</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor: instantiate a ConfigFile object.</span>

<span class="sd">        sources (string, dict or special object (see _import_object)): a</span>
<span class="sd">        sequence of all the files, dictionaries and special objects to be</span>
<span class="sd">        parsed</span>
<span class="sd">        mode (string): this sets if and how the next source in the chain</span>
<span class="sd">        overwrites already imported sections and options; available choices are</span>
<span class="sd">        &#39;upgrade&#39;, &#39;update&#39;, &#39;reset&#39; and &#39;add&#39; (see the respective methods for</span>
<span class="sd">        more details)</span>
<span class="sd">        ignore_case (boolean): if True, section and option names will be</span>
<span class="sd">        compared ignoring case differences; regular expressions will use re.I</span>
<span class="sd">        flag</span>
<span class="sd">        subsections (boolean): if True (default) subsections are allowed</span>
<span class="sd">        interpolation (boolean): if True, option values will be interpolated</span>
<span class="sd">        using values from other options through the special syntax</span>
<span class="sd">        ${section$:section$:option$}. Options will be interpolated only once at</span>
<span class="sd">        importing: all links among options will be lost after importing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># The Python 3 definition was:</span>
        <span class="c">#def __init__(self,</span>
        <span class="c">#             *sources,</span>
        <span class="c">#             mode=&#39;upgrade&#39;,</span>
        <span class="c">#             inherit_options=False,</span>
        <span class="c">#             subsections=True,</span>
        <span class="c">#             ignore_case=True,</span>
        <span class="c">#             interpolation=False):</span>
        <span class="c"># But to keep compatibility with Python 2 it has been changed to the</span>
        <span class="c"># current</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">,</span> <span class="s">&#39;upgrade&#39;</span><span class="p">)</span>
        <span class="n">inherit_options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;inherit_options&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">subsections</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;subsections&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">ignore_case</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ignore_case&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">interpolation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;interpolation&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="c"># Root section</span>
        <span class="n">Section</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                            <span class="n">inherit_options</span><span class="o">=</span><span class="n">inherit_options</span><span class="p">,</span>
                                            <span class="n">subsections</span><span class="o">=</span><span class="n">subsections</span><span class="p">,</span>
                                            <span class="n">ignore_case</span><span class="o">=</span><span class="n">ignore_case</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">overwrite</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">reset</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;upgrade&quot;</span><span class="p">:</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
                <span class="s">&quot;update&quot;</span><span class="p">:</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
                <span class="s">&quot;reset&quot;</span><span class="p">:</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
                <span class="s">&quot;add&quot;</span><span class="p">:</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
            <span class="p">}[</span><span class="n">mode</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Unrecognized importing mode: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_import</span><span class="p">(</span><span class="n">sources</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="n">add</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="n">reset</span><span class="p">,</span>
                                                <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>


<span class="c">### EXCEPTIONS ###</span>
</div></div>
<div class="viewcode-block" id="ConfigFileError"><a class="viewcode-back" href="../index.html#configfile.ConfigFileError">[docs]</a><span class="k">class</span> <span class="nc">ConfigFileError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The root exception, useful for catching generic errors from this module.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="ParsingError"><a class="viewcode-back" href="../index.html#configfile.ParsingError">[docs]</a><span class="k">class</span> <span class="nc">ParsingError</span><span class="p">(</span><span class="n">ConfigFileError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An error, overcome at parse time, due to bad file formatting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="NonExistentFileError"><a class="viewcode-back" href="../index.html#configfile.NonExistentFileError">[docs]</a><span class="k">class</span> <span class="nc">NonExistentFileError</span><span class="p">(</span><span class="n">ConfigFileError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A non-existent configuration file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="InvalidFileError"><a class="viewcode-back" href="../index.html#configfile.InvalidFileError">[docs]</a><span class="k">class</span> <span class="nc">InvalidFileError</span><span class="p">(</span><span class="n">ConfigFileError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An invalid configuration file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="InvalidObjectError"><a class="viewcode-back" href="../index.html#configfile.InvalidObjectError">[docs]</a><span class="k">class</span> <span class="nc">InvalidObjectError</span><span class="p">(</span><span class="n">ConfigFileError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An invalid key found in an importing object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">ConfigFile 1.1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Dario Giovannetti.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>